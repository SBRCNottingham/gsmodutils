
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Testing &#8212; gsmodutils 0.0.1 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Docker" href="docker.html" />
    <link rel="prev" title="CLI" href="cli.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="testing">
<h1>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h1>
<p>A genome scale model is almost never finished.
Thousands of hours of manual curation can go in to models and, as a result,
changes can break things.
For this reason it is good practice to work in a <em>test driven</em> manner.
Creating good test cases ensures that if a model once meets criteria for
experimental validation it always meets this criteria.</p>
<div class="section" id="running-the-default-tests">
<h2>Running the default tests<a class="headerlink" href="#running-the-default-tests" title="Permalink to this headline">¶</a></h2>
<p>A test report can be generated by the tester. This is a command line
utility which, by default, loads each model, set of conditions and
design and performs the FBA simulations. This ensures that any changes
to the project files maintain designs, models and conditions.</p>
<div class="highlight-guess"><div class="highlight"><pre><span></span>$ gsmodutils <span class="nb">test</span>
</pre></div>
</div>
<p>The output from the terminal should look something like this:</p>
<div class="highlight-guess"><div class="highlight"><pre><span></span>------------------------- gsmodutils test results -------------------------
Running tests: ....
Default project file tests (models, designs, conditions):
Counted 4 test assertions with 0 failures
Project file completed all tests without error
    --model_e_coli_core.json

    --design_mevalonate_calvin

    --design_mevalonate_cbb

    --design_cbb_cycle

Ran 4 test assertions with a total of 0 errors (100.0% success)
</pre></div>
</div>
</div>
<div class="section" id="custom-tests">
<h2>Custom tests<a class="headerlink" href="#custom-tests" title="Permalink to this headline">¶</a></h2>
<p>Whilst the default tests provided by the tool are a useful way of
ensuring that the project files remain valid after manual curation they
do not have the capability to match all design goals. These design goals
will be based on a data driven approach to genome scale model
development and often require a more fundamental understanding of how an
organism functions.</p>
<p>For this reason we give an example here of the TCA cycle in E coli. In
our case this is a pathway that should be conserved and used in all FBA
cases. If a modification were to break this (without being a specific
engineering goal) the model’s validity comes in to question.</p>
<div class="highlight-guess"><div class="highlight"><pre><span></span><span class="n">TODO</span><span class="o">:</span> <span class="n">Add</span> <span class="n">an</span> <span class="n">example</span> <span class="n">custom</span> <span class="n">test</span>
</pre></div>
</div>
</div>
<div class="section" id="writing-python-test-cases">
<h2>Writing python test cases<a class="headerlink" href="#writing-python-test-cases" title="Permalink to this headline">¶</a></h2>
<p>For many use cases, it may require the use of more complex
functionality. For this reason, gsmodutils allows users to write fully
featured python test cases. This means that any code written in python
can be used and assertion statements can be written and included in the
test reports.</p>
<p>Any file of the format <code class="docutils literal"><span class="pre">tests/test_*.py</span></code> will be included in the test
cases run by the project tester instance.</p>
<p>Only functions of the prototype  <code class="docutils literal"><span class="pre">def</span> <span class="pre">func_&lt;name&gt;(model,</span> <span class="pre">project,</span> <span class="pre">log)</span></code>
will be called by the tester.</p>
<p>For test cases use the method
<code class="docutils literal"><span class="pre">log.assertion(&lt;bool:</span> <span class="pre">statement&gt;,</span> <span class="pre">&lt;str:</span> <span class="pre">success&gt;,</span> <span class="pre">&lt;str:failure&gt;)</span></code>
to record the result of a given test assertion.</p>
<p><code class="docutils literal"><span class="pre">log</span></code> is always an instance of the <code class="docutils literal"><span class="pre">gsmodutils.testutils.TestRecord</span></code>
class.</p>
<p>For example, create the python module <code class="docutils literal"><span class="pre">tests/test_my_model.py</span></code>
and then add the code:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">log</span><span class="p">):</span>
    <span class="n">solution</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
    <span class="n">log</span><span class="o">.</span><span class="n">assertion</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">f</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s2">&quot;Model grows&quot;</span><span class="p">,</span> <span class="s2">&quot;Model does not grow&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>When creating tests the class <code class="docutils literal"><span class="pre">gsmodutils.testutils.ModelTestSelector</span></code>
can be used as a helper decorator to load models and designs of specific names.
The same test function will be called repeatedly with all combinations of
models, designs and conditions specified.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gsmodutils.testutils</span> <span class="kn">import</span> <span class="n">ModelTestSelector</span>

<span class="nd">@ModelTestSelector</span><span class="p">(</span><span class="n">models</span><span class="o">=</span><span class="p">[],</span> <span class="n">conditions</span><span class="o">=</span><span class="p">[],</span> <span class="n">designs</span><span class="o">=</span><span class="p">[])</span>
<span class="k">def</span> <span class="nf">test_func</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">log</span><span class="p">):</span>
    <span class="n">log</span><span class="o">.</span><span class="n">assertion</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="s2">&quot;Works&quot;</span><span class="p">,</span> <span class="s2">&quot;Does not work&quot;</span><span class="p">,</span> <span class="s2">&quot;Test&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="module-gsmodutils.tester">
<span id="gsmtester-class"></span><h2>GSMtester class<a class="headerlink" href="#module-gsmodutils.tester" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="gsmodutils.tester.GSMTester">
<em class="property">class </em><code class="descclassname">gsmodutils.tester.</code><code class="descname">GSMTester</code><span class="sig-paren">(</span><em>project</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/gsmodutils/tester.html#GSMTester"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gsmodutils.tester.GSMTester" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/2/library/functions.html#object" title="(in Python v2.7)"><code class="xref py py-class docutils literal"><span class="pre">object</span></code></a></p>
<p>Loads models and executes user specified tests for the genome scale models</p>
<dl class="method">
<dt id="gsmodutils.tester.GSMTester.collect_tests">
<code class="descname">collect_tests</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/gsmodutils/tester.html#GSMTester.collect_tests"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gsmodutils.tester.GSMTester.collect_tests" title="Permalink to this definition">¶</a></dt>
<dd><p>Collects all tests but does not run them</p>
</dd></dl>

<dl class="method">
<dt id="gsmodutils.tester.GSMTester.iter_basetf">
<code class="descname">iter_basetf</code><span class="sig-paren">(</span><em>base_file</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/gsmodutils/tester.html#GSMTester.iter_basetf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gsmodutils.tester.GSMTester.iter_basetf" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a base test file (.json or .py)</p>
</dd></dl>

<dl class="method">
<dt id="gsmodutils.tester.GSMTester.iter_tests">
<code class="descname">iter_tests</code><span class="sig-paren">(</span><em>recollect=False</em>, <em>skip_default=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/gsmodutils/tester.html#GSMTester.iter_tests"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gsmodutils.tester.GSMTester.iter_tests" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate each test function</p>
</dd></dl>

<dl class="method">
<dt id="gsmodutils.tester.GSMTester.run_all">
<code class="descname">run_all</code><span class="sig-paren">(</span><em>recollect=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/gsmodutils/tester.html#GSMTester.run_all"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gsmodutils.tester.GSMTester.run_all" title="Permalink to this definition">¶</a></dt>
<dd><p>Find and run all tests for a project, executes rather than returning generator</p>
</dd></dl>

<dl class="method">
<dt id="gsmodutils.tester.GSMTester.run_by_id">
<code class="descname">run_by_id</code><span class="sig-paren">(</span><em>tid</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/gsmodutils/tester.html#GSMTester.run_by_id"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gsmodutils.tester.GSMTester.run_by_id" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns result of individual test function</p>
</dd></dl>

<dl class="attribute">
<dt id="gsmodutils.tester.GSMTester.tests">
<code class="descname">tests</code><a class="headerlink" href="#gsmodutils.tester.GSMTester.tests" title="Permalink to this definition">¶</a></dt>
<dd><p>Tuple of dict tests and executable tests</p>
</dd></dl>

<dl class="method">
<dt id="gsmodutils.tester.GSMTester.to_dict">
<code class="descname">to_dict</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/gsmodutils/tester.html#GSMTester.to_dict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gsmodutils.tester.GSMTester.to_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>json serialisable log - call after running tests</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="gsmodutils.tester.stdout_ctx">
<code class="descclassname">gsmodutils.tester.</code><code class="descname">stdout_ctx</code><span class="sig-paren">(</span><em>stdout=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/gsmodutils/tester.html#stdout_ctx"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gsmodutils.tester.stdout_ctx" title="Permalink to this definition">¶</a></dt>
<dd><p>Context to capture standard output of python executed tests during run time
This is displayed to the user for them to see</p>
</dd></dl>

</div>
<div class="section" id="testutils-module">
<h2>testutils module<a class="headerlink" href="#testutils-module" title="Permalink to this headline">¶</a></h2>
<span class="target" id="module-gsmodutils.testutils"></span><p>Utilities for test functions</p>
<p>This code assumes that the namespace that python based tests are in is correctly assigned, otherwise global
variables won’t be present and this will throw errors</p>
<dl class="class">
<dt id="gsmodutils.testutils.ModelTestSelector">
<em class="property">class </em><code class="descclassname">gsmodutils.testutils.</code><code class="descname">ModelTestSelector</code><span class="sig-paren">(</span><em>models=None</em>, <em>conditions=None</em>, <em>designs=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/gsmodutils/testutils.html#ModelTestSelector"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gsmodutils.testutils.ModelTestSelector" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/2/library/functions.html#object" title="(in Python v2.7)"><code class="xref py py-class docutils literal"><span class="pre">object</span></code></a></p>
</dd></dl>

<dl class="class">
<dt id="gsmodutils.testutils.TestRecord">
<em class="property">class </em><code class="descclassname">gsmodutils.testutils.</code><code class="descname">TestRecord</code><span class="sig-paren">(</span><em>tid=''</em>, <em>parent=None</em>, <em>param_child=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/gsmodutils/testutils.html#TestRecord"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gsmodutils.testutils.TestRecord" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/2/library/functions.html#object" title="(in Python v2.7)"><code class="xref py py-class docutils literal"><span class="pre">object</span></code></a></p>
<p>Class for handling logging of errors in tester
follows a hierarchical pattern as log records allow child records
This is a bit of a weird data structure but the objective is to (in a future version) encapsulate all tests inside
an instance of Test Record</p>
<dl class="method">
<dt id="gsmodutils.testutils.TestRecord.add_error">
<code class="descname">add_error</code><span class="sig-paren">(</span><em>msg</em>, <em>desc=''</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/gsmodutils/testutils.html#TestRecord.add_error"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gsmodutils.testutils.TestRecord.add_error" title="Permalink to this definition">¶</a></dt>
<dd><p>For errors loading tests, e.g. success cases can’t be reached because the model doesn’t load or can’t get a
feasable solution</p>
</dd></dl>

<dl class="method">
<dt id="gsmodutils.testutils.TestRecord.assertion">
<code class="descname">assertion</code><span class="sig-paren">(</span><em>statement</em>, <em>success_msg</em>, <em>error_msg</em>, <em>desc=''</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/gsmodutils/testutils.html#TestRecord.assertion"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gsmodutils.testutils.TestRecord.assertion" title="Permalink to this definition">¶</a></dt>
<dd><p>Called within test functions to store errors and successes
Results will be appended to the correct log reccords</p>
</dd></dl>

<dl class="method">
<dt id="gsmodutils.testutils.TestRecord.create_child">
<code class="descname">create_child</code><span class="sig-paren">(</span><em>new_id</em>, <em>param_child=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/gsmodutils/testutils.html#TestRecord.create_child"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gsmodutils.testutils.TestRecord.create_child" title="Permalink to this definition">¶</a></dt>
<dd><p>Used within decorator helper functions to allow multiple tests with the same function but where other parameters
change</p>
</dd></dl>

<dl class="attribute">
<dt id="gsmodutils.testutils.TestRecord.is_success">
<code class="descname">is_success</code><a class="headerlink" href="#gsmodutils.testutils.TestRecord.is_success" title="Permalink to this definition">¶</a></dt>
<dd><p>The test function is considered a failure if there are one or more error logs</p>
</dd></dl>

<dl class="attribute">
<dt id="gsmodutils.testutils.TestRecord.log_count">
<code class="descname">log_count</code><a class="headerlink" href="#gsmodutils.testutils.TestRecord.log_count" title="Permalink to this definition">¶</a></dt>
<dd><p>count total errors for self and children</p>
</dd></dl>

<dl class="method">
<dt id="gsmodutils.testutils.TestRecord.to_dict">
<code class="descname">to_dict</code><span class="sig-paren">(</span><em>stk=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/gsmodutils/testutils.html#TestRecord.to_dict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gsmodutils.testutils.TestRecord.to_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>converts log into dictionary form for portability
stk stops cyclic behaviour</p>
</dd></dl>

</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">gsmodutils</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">User Guide:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="project.html">Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="designs.html">Designs</a></li>
<li class="toctree-l1"><a class="reference internal" href="designs.html#exporting-and-importing-designs-and-conditions">Exporting and importing designs and conditions</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">CLI</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Testing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#running-the-default-tests">Running the default tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#custom-tests">Custom tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#writing-python-test-cases">Writing python test cases</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-gsmodutils.tester">GSMtester class</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testutils-module">testutils module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">Docker</a></li>
</ul>
<p class="caption"><span class="caption-text">Utilities:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="metacyc.html">MetaCyc</a></li>
<li class="toctree-l1"><a class="reference internal" href="scrumpy.html">ScrumPy</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="cli.html" title="previous chapter">CLI</a></li>
      <li>Next: <a href="docker.html" title="next chapter">Docker</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, James Gilbert.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/tests.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>